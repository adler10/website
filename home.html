<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project Hub</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --bg-dark: #0f172a;
            --bg-panel: #1e293b;
            --border: #334155;
            --text-main: #f8fafc;
            --text-muted: #94a3b8;
            --accent: #3b82f6;
            --accent-hover: #2563eb;
        }

        body {
            /* HIDDEN BY DEFAULT FOR SECURITY - Revealed by Firebase Script */
            display: none; 
            
            background-color: var(--bg-dark);
            color: var(--text-main);
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            overflow: hidden;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: var(--bg-dark); 
        }
        ::-webkit-scrollbar-thumb {
            background: var(--border); 
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: var(--text-muted); 
        }

        .folder-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 1rem;
        }

        .item-card {
            transition: all 0.2s ease;
        }
        .item-card:hover {
            background-color: var(--bg-panel);
            transform: translateY(-2px);
        }

        .tree-item:hover {
            background-color: rgba(255,255,255,0.05);
        }
        .tree-item.active {
            background-color: rgba(59, 130, 246, 0.15);
            color: var(--accent);
            border-right: 2px solid var(--accent);
        }
    </style>
</head>
<body class="h-screen flex-col">

    <!-- Top Navigation Bar -->
    <header class="h-14 border-b border-slate-700 flex items-center px-4 justify-between bg-slate-900 shrink-0">
        <div class="flex items-center gap-3">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-blue-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" />
            </svg>
            <h1 class="font-bold text-lg tracking-wide hidden sm:block">Project<span class="text-blue-500">Hub</span></h1>
        </div>

        <!-- Search / Filter -->
        <div class="relative w-full max-w-md mx-4 hidden md:block">
            <input type="text" id="searchInput" placeholder="Find file..." 
                class="w-full bg-slate-800 border border-slate-700 rounded-md py-1.5 px-4 text-sm focus:outline-none focus:border-blue-500 transition-colors">
            <svg class="w-4 h-4 absolute right-3 top-2 text-slate-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
        </div>

        <!-- User Profile & Time -->
        <div class="flex items-center gap-4">
            <div class="flex items-center gap-2 text-xs text-right">
                <div class="hidden sm:block">
                    <div id="user-email" class="text-blue-400 font-medium">Loading...</div>
                    <div id="clock" class="text-slate-500 font-mono">00:00</div>
                </div>
                <button onclick="window.logout()" class="bg-red-900/30 hover:bg-red-900/50 text-red-400 px-3 py-1.5 rounded border border-red-900/50 transition-colors text-xs font-bold">
                    LOGOUT
                </button>
            </div>
        </div>
    </header>

    <!-- Main Workspace -->
    <div class="flex-1 flex overflow-hidden">
        
        <!-- Sidebar (Tree View) - Hidden on mobile -->
        <aside class="w-64 bg-slate-900 border-r border-slate-700 flex-col hidden md:flex">
            <div class="p-3 text-xs font-bold text-slate-500 uppercase tracking-wider">Explorer</div>
            <div id="sidebarTree" class="flex-1 overflow-y-auto px-2 pb-4 font-mono text-sm">
                <!-- Tree content injected by JS -->
            </div>
        </aside>

        <!-- Main Content Area -->
        <main class="flex-1 flex flex-col bg-slate-950 relative">
            
            <!-- Breadcrumbs bar -->
            <div class="h-10 border-b border-slate-800 flex items-center px-4 gap-2 text-sm text-slate-400 bg-slate-900/50 backdrop-blur-sm">
                <button onclick="navigateHome()" class="hover:text-white transition-colors">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path></svg>
                </button>
                <div id="breadcrumbs" class="flex items-center gap-1 overflow-x-auto whitespace-nowrap scrollbar-hide">
                    <!-- Breadcrumbs injected here -->
                </div>
            </div>

            <!-- Content Grid -->
            <div id="contentArea" class="flex-1 overflow-y-auto p-6">
                <!-- Grid content injected by JS -->
            </div>

            <!-- Status Bar -->
            <div class="h-6 bg-slate-900 border-t border-slate-800 flex items-center px-4 text-xs text-slate-500 justify-between shrink-0">
                <span id="itemCount">0 items</span>
                <span>Web System v1.1 â€¢ Secure</span>
            </div>
        </main>
    </div>

    <!-- UI Logic -->
    <script>
        // --- DATA DEFINITION ---
        const rawFiles = [
            "alarm/display.html",
            "alarm/lh19-1.html",
            "alarm/lh19-1_app.html",
            "alarm/lh40.html",
            "alarm/settings.html",
            "alarm/IMG_0269.jpeg",
            "fw/dispatch.html",
            "fw/dispatch_tutorial.html",
            "fw/dispatchv2.html",
            "fw/documentation.html",
            "fw/documentationv2.html",
            "game/display.html",
            "game/pwa.html",
            "jf/balicup/stationen/1.html",
            "jf/balicup/stationen/2.html",
            "jf/balicup/stationen/3.html",
            "jf/balicup/stationen/4.html",
            "jf/balicup/stationen/5.html",
            "jf/balicup/stationen/6.html",
            "jf/balicup/stationen/7.html",
            "jf/balicup/stationen/8.html",
            "jf/balicup/admin.html",
            "jf/balicup/ranking.html",
            "jf/bali.html",
            "jf/balicup.html",
            "jf/docs.html",
            "jf/funktmo.html",
            "jf/funktmokarte.html",
            "jf/test.html",
            "jf/wertung.html",
            "jf/wertung2.html",
            "jf/wertung3.html",
            "lst/index.html",
            "lst/js/", 
            "403.html",
            "404.html",
            "410.html",
            "418.html",
            "503.html",
            "anwesenheit.html",
            "bahn.html",
            "chat.html",
            "github.html",
            "instagram.html",
            "index2.html",
            "lyrik.html",
            "monitor.html",
            "pizzatest.html"
        ];

        // Icons
        const icons = {
            folder: `<svg class="w-10 h-10 text-blue-500 mb-2" fill="currentColor" viewBox="0 0 20 20"><path d="M2 6a2 2 0 012-2h5l2 2h5a2 2 0 012 2v6a2 2 0 01-2 2H4a2 2 0 01-2-2V6z"></path></svg>`,
            folderSm: `<svg class="w-4 h-4 text-blue-500 mr-2 shrink-0" fill="currentColor" viewBox="0 0 20 20"><path d="M2 6a2 2 0 012-2h5l2 2h5a2 2 0 012 2v6a2 2 0 01-2 2H4a2 2 0 01-2-2V6z"></path></svg>`,
            html: `<svg class="w-10 h-10 text-orange-500 mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M14 2v6h6"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M10 13l-2 2.5 2 2.5m4-5l2 2.5-2 2.5"></path></svg>`,
            htmlSm: `<svg class="w-4 h-4 text-orange-500 mr-2 shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>`,
            image: `<svg class="w-10 h-10 text-purple-500 mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>`,
            imageSm: `<svg class="w-4 h-4 text-purple-500 mr-2 shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>`,
            unknown: `<svg class="w-10 h-10 text-slate-500 mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 2H7a2 2 0 00-2 2v14a2 2 0 002 2z"></path></svg>`
        };

        // --- TREE BUILDER ---
        function buildFileSystem(paths) {
            const root = { name: "Home", type: "folder", children: {}, path: "" };

            paths.forEach(path => {
                const parts = path.split('/').filter(p => p.length > 0);
                let current = root;
                let fullPath = "";

                parts.forEach((part, index) => {
                    fullPath += (fullPath ? "/" : "") + part;
                    const isLast = index === parts.length - 1;
                    const isFile = isLast && (part.includes('.') || !path.endsWith('/'));

                    if (!current.children[part]) {
                        if (isFile) {
                            let type = 'unknown';
                            if (part.endsWith('.html')) type = 'html';
                            if (part.match(/\.(jpg|jpeg|png|gif)$/i)) type = 'image';
                            current.children[part] = { name: part, type: type, path: fullPath };
                        } else {
                            current.children[part] = { name: part, type: 'folder', children: {}, path: fullPath };
                        }
                    }
                    if (!isFile) current = current.children[part];
                });
            });
            return root;
        }

        const fileSystem = buildFileSystem(rawFiles);
        let currentDirectory = fileSystem;

        // --- RENDER FUNCTIONS ---
        function getIcon(type, size = 'lg') {
            if (size === 'sm') {
                if (type === 'folder') return icons.folderSm;
                if (type === 'html') return icons.htmlSm;
                if (type === 'image') return icons.imageSm;
                return icons.htmlSm;
            }
            if (type === 'folder') return icons.folder;
            if (type === 'html') return icons.html;
            if (type === 'image') return icons.image;
            return icons.unknown;
        }

        function renderSidebar(node = fileSystem, level = 0) {
            let html = '';
            const entries = Object.values(node.children || {}).sort((a, b) => {
                if (a.type === 'folder' && b.type !== 'folder') return -1;
                if (a.type !== 'folder' && b.type === 'folder') return 1;
                return a.name.localeCompare(b.name);
            });

            entries.forEach(item => {
                if (item.type === 'folder') {
                    const isActive = currentDirectory === item;
                    const padding = level * 12 + 8;
                    html += `
                        <div class="tree-item cursor-pointer py-1 text-slate-300 rounded flex items-center ${isActive ? 'active' : ''}" 
                             style="padding-left: ${padding}px"
                             onclick="navigateToPath('${item.path}')">
                            ${icons.folderSm}
                            <span class="truncate">${item.name}</span>
                        </div>
                    `;
                    html += renderSidebar(item, level + 1);
                }
            });
            return html;
        }

        function renderBreadcrumbs() {
            const pathParts = currentDirectory.path.split('/').filter(p => p);
            const container = document.getElementById('breadcrumbs');
            
            let html = '';
            let builtPath = '';

            pathParts.forEach((part, idx) => {
                builtPath += (builtPath ? "/" : "") + part;
                html += `
                    <span class="text-slate-600">/</span>
                    <button onclick="navigateToPath('${builtPath}')" class="hover:text-white px-1 rounded hover:bg-slate-800 transition-colors">
                        ${part}
                    </button>
                `;
            });
            
            if (pathParts.length === 0) html = `<span class="text-slate-500 italic ml-1">Home</span>`;
            container.innerHTML = html;
        }

        function renderMainContent(directory = currentDirectory, filter = "") {
            const grid = document.getElementById('contentArea');
            let entries = Object.values(directory.children || {});
            
            if (filter) {
                const searchResults = [];
                const searchRecursive = (node) => {
                    Object.values(node.children || {}).forEach(child => {
                        if (child.name.toLowerCase().includes(filter.toLowerCase())) searchResults.push(child);
                        if (child.type === 'folder') searchRecursive(child);
                    });
                };
                searchRecursive(fileSystem);
                entries = searchResults;
            }

            entries.sort((a, b) => {
                if (a.type === 'folder' && b.type !== 'folder') return -1;
                if (a.type !== 'folder' && b.type === 'folder') return 1;
                return a.name.localeCompare(b.name);
            });

            document.getElementById('itemCount').innerText = `${entries.length} items`;

            if (entries.length === 0) {
                grid.innerHTML = `
                    <div class="flex flex-col items-center justify-center h-full text-slate-500 opacity-50">
                        <svg class="w-16 h-16 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M5 19a2 2 0 01-2-2V7a2 2 0 012-2h4l2 2h4a2 2 0 012 2v1m-3-3l-3 3m0 0l-3-3m3 3V3"></path></svg>
                        <p>This folder is empty</p>
                    </div>`;
                return;
            }

            grid.innerHTML = `<div class="folder-grid">` + entries.map(item => {
                const isFolder = item.type === 'folder';
                const href = isFolder ? '#' : item.path;
                const clickHandler = isFolder ? `onclick="navigateToPath('${item.path}'); return false;"` : '';
                const target = isFolder ? '' : `target="_blank"`;

                return `
                    <a href="${href}" ${clickHandler} ${target} class="item-card block p-4 rounded border border-transparent hover:border-slate-700 flex flex-col items-center justify-center text-center cursor-pointer group">
                        <div class="transform group-hover:scale-110 transition-transform duration-200">
                            ${getIcon(item.type)}
                        </div>
                        <span class="text-xs sm:text-sm text-slate-300 break-all line-clamp-2">${item.name}</span>
                    </a>
                `;
            }).join('') + `</div>`;
        }

        // --- NAV HELPERS ---
        function findNodeByPath(pathStr) {
            if (!pathStr) return fileSystem;
            const parts = pathStr.split('/').filter(p => p);
            let current = fileSystem;
            for (const part of parts) {
                if (current.children && current.children[part]) current = current.children[part];
                else return null;
            }
            return current;
        }

        function navigateToPath(path) {
            const node = findNodeByPath(path);
            if (node && node.type === 'folder') {
                currentDirectory = node;
                renderBreadcrumbs();
                renderMainContent();
                document.querySelectorAll('.tree-item').forEach(el => el.classList.remove('active'));
                document.getElementById('sidebarTree').innerHTML = renderSidebar();
            }
        }
        function navigateHome() { navigateToPath(""); }

        // --- INIT UI ---
        document.getElementById('searchInput').addEventListener('input', (e) => {
            const val = e.target.value;
            renderMainContent(val ? fileSystem : currentDirectory, val);
        });

        setInterval(() => {
            document.getElementById('clock').innerText = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
        }, 1000);

        // Initial paint
        document.getElementById('sidebarTree').innerHTML = renderSidebar();
        renderBreadcrumbs();
        renderMainContent();
    </script>

    <!-- FIREBASE AUTH GUARD -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBSI3GyiL3584lh0Nwb79hEEW35suvSh4g",
            authDomain: "auth-107d8.firebaseapp.com",
            projectId: "auth-107d8",
            storageBucket: "auth-107d8.firebasestorage.app",
            messagingSenderId: "735861054924",
            appId: "1:735861054924:web:c87c51e6abcb8f48481169",
            measurementId: "G-SYBYJH5P8D"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);

        onAuthStateChanged(auth, (user) => {
            if (user) {
                document.body.style.display = 'flex'; // Changed to flex for layout
                document.getElementById('user-email').textContent = user.email;
            } else {
                sessionStorage.setItem('redirect_to', window.location.href);
                // Ensure you have an index.html that handles login!
                window.location.replace('index.html');
            }
        });

        window.logout = () => {
            signOut(auth).then(() => window.location.replace('index.html'));
        };
    </script>
</body>
</html>
