import React, { useState, useEffect, useRef, memo } from 'react';
import { initializeApp } from 'firebase/app';
import { getAuth, signInWithCustomToken, signInAnonymously, onAuthStateChanged } from 'firebase/auth';
import { getFirestore, doc, collection, onSnapshot, updateDoc, setDoc } from 'firebase/firestore';
import { Battery, Wifi, Settings, Bell, Activity, X, ChevronDown, Menu as MenuIcon, Monitor, FileText, AlertTriangle, User, Smartphone, Cast, PlayCircle, StopCircle, Heart } from 'lucide-react';

// --- FIREBASE CONFIGURATION ---
// Logic: Use the environment's config if available (preview mode), 
// otherwise use your specific config (GitHub Pages / Standalone mode).
const getFirebaseConfig = () => {
  if (typeof __firebase_config !== 'undefined') {
    return JSON.parse(__firebase_config);
  }
  return {
    apiKey: "AIzaSyBr5Gz3ZB0pRFq5dXuh0pu73uMXXT0KOrw",
    authDomain: "corpuls-9ac39.firebaseapp.com",
    projectId: "corpuls-9ac39",
    storageBucket: "corpuls-9ac39.firebasestorage.app",
    messagingSenderId: "75705998414",
    appId: "1:75705998414:web:bdef64bf54afe228f8771f",
    measurementId: "G-GLX59X75WJ"
  };
};

const app = initializeApp(getFirebaseConfig());
const auth = getAuth(app);
const db = getFirestore(app);

// If running standalone, we don't have __app_id, so we use a static string
const appId = typeof __app_id !== 'undefined' ? __app_id : 'corpuls-web-sim';

// --- SEO / ROBOTS GUARD ---
// Inject noindex tag programmatically
const useNoIndex = () => {
  useEffect(() => {
    const meta = document.createElement('meta');
    meta.name = "robots";
    meta.content = "noindex, nofollow";
    document.head.appendChild(meta);
    return () => document.head.removeChild(meta);
  }, []);
};

// --- WAVEFORM GENERATORS ---
const getPQRSTValue = (progress, rhythmType, variationSeed, lead = 'II') => {
  if (rhythmType === 'Asystole') return (Math.random() - 0.5) * 0.05;
  if (rhythmType === 'VFib') return Math.sin(progress * 50) * 0.5 + (Math.random() - 0.5) * 0.4;
  const p = progress;
  let y = (Math.random() - 0.5) * 0.04; 
  let amp = 1.0; let sDepth = 1.0;
  if (lead === 'I') { amp = 0.6; sDepth = 0.5; }
  else if (lead === 'II') { amp = 1.2; sDepth = 1.0; }
  else if (lead === 'III') { amp = 0.7; sDepth = 1.8; }
  else if (lead === 'V1') { amp = 0.5; sDepth = 2.0; }
  const rHeight = (amp * 1.0) + (Math.sin(variationSeed) * 0.05); 
  const tHeight = 0.15 + (Math.cos(variationSeed) * 0.02);
  if (p > 0.1 && p < 0.2) y += 0.1 * Math.sin((p - 0.1) * Math.PI * 10); 
  else if (p > 0.43 && p < 0.45) y -= 0.15 * rHeight; 
  else if (p >= 0.45 && p < 0.48) y += 1.0 * rHeight; 
  else if (p >= 0.48 && p < 0.50) y -= 0.25 * rHeight * sDepth; 
  else if (p > 0.7 && p < 0.85) y += tHeight * Math.sin((p - 0.7) * Math.PI * 6.6); 
  return y;
};
const getPlethValue = (progress, type) => {
  if (type === 'Asystole' || type === 'VFib') return 0;
  const p = progress;
  let y = 0;
  if (p < 0.3) y = Math.sin(p * Math.PI * 3.33);
  else if (p >= 0.3 && p < 0.6) y = 0.3 * Math.sin((p - 0.3) * Math.PI * 3.33);
  return y;
};
const getCapnoValue = (progress, type) => {
  if (type === 'Asystole') return 0;
  const p = progress;
  let y = 0;
  if (p >= 0.1 && p < 0.2) y = (p - 0.1) * 10; 
  else if (p >= 0.2 && p < 0.5) y = 1.0 + (p - 0.2) * 0.1; 
  else if (p >= 0.5 && p < 0.6) y = 1.0 - ((p - 0.5) * 10);
  if (y > 0) y += (Math.random() - 0.5) * 0.05;
  return Math.max(0, y);
};

// --- COMPONENTS ---

const WaveformCanvas = memo(({ label, color, gridColor, rhythmType, waveType = 'ecg', lead = 'II', targetRate }) => {
  const canvasRef = useRef(null);
  const requestRef = useRef(null);
  const stateRef = useRef({ phase: 0, variation: 0, cursor: 0, buffer: [], currentSmoothedRate: 80 });

  useEffect(() => {
    if (canvasRef.current) stateRef.current.buffer = new Array(canvasRef.current.width).fill(0);
  }, []);

  const animate = () => {
    const canvas = canvasRef.current;
    if (!canvas) return;
    const ctx = canvas.getContext('2d');
    const width = canvas.width;
    const height = canvas.height;

    const target = targetRate.current; 
    const diff = target - stateRef.current.currentSmoothedRate;
    stateRef.current.currentSmoothedRate += diff * 0.05; 
    
    let effectiveRate = stateRef.current.currentSmoothedRate;
    if (rhythmType !== 'Asystole' && rhythmType !== 'VFib') effectiveRate += Math.sin(Date.now() / 500) * 2; 
    if (waveType === 'co2') effectiveRate = effectiveRate / 4;
    if (waveType === 'ecg' && rhythmType === 'VFib') effectiveRate = 300;

    const eventsPerSecond = effectiveRate / 60;
    const phaseStep = eventsPerSecond / 60; 
    stateRef.current.phase += phaseStep;
    if (stateRef.current.phase >= 1) {
      stateRef.current.phase -= 1;
      stateRef.current.variation = Math.random() * 100;
    }

    let newValue = 0;
    if (waveType === 'ecg') newValue = getPQRSTValue(stateRef.current.phase, rhythmType, stateRef.current.variation, lead);
    else if (waveType === 'pleth') { let p = stateRef.current.phase - 0.2; if (p < 0) p += 1; newValue = getPlethValue(p, rhythmType); }
    else if (waveType === 'co2') { newValue = getCapnoValue(stateRef.current.phase, rhythmType); }

    const speed = 2; 
    for(let s=0; s<speed; s++) {
        stateRef.current.cursor++;
        if (stateRef.current.cursor >= width) stateRef.current.cursor = 0;
        if (stateRef.current.buffer) stateRef.current.buffer[stateRef.current.cursor] = newValue;
    }

    ctx.fillStyle = '#000000'; ctx.fillRect(0, 0, width, height);
    ctx.strokeStyle = gridColor || '#333'; ctx.lineWidth = 1; ctx.beginPath();
    for (let x = 0; x < width; x += 25) ctx.moveTo(x, 0), ctx.lineTo(x, height);
    for (let y = 0; y < height; y += 25) ctx.moveTo(0, y), ctx.lineTo(width, y);
    ctx.stroke();

    ctx.strokeStyle = color; ctx.lineWidth = waveType === 'co2' ? 3 : 2; ctx.lineJoin = 'round';
    if (stateRef.current.buffer) {
        ctx.beginPath();
        const cursor = stateRef.current.cursor;
        const eraserGap = 30; 
        const scaleY = (val) => {
            let scaler = height / 3; let offset = height / 2;
            if (waveType === 'co2') { scaler = height / 1.5; offset = height - 10; }
            return offset - (val * scaler);
        }
        if (cursor + eraserGap < width) {
            for (let i = cursor + eraserGap; i < width; i++) {
                if (i === cursor + eraserGap) ctx.moveTo(i, scaleY(stateRef.current.buffer[i]));
                else ctx.lineTo(i, scaleY(stateRef.current.buffer[i]));
            }
        }
        ctx.stroke(); ctx.beginPath();
        for (let i = 0; i < cursor; i++) {
            if (i === 0) ctx.moveTo(i, scaleY(stateRef.current.buffer[i]));
            else ctx.lineTo(i, scaleY(stateRef.current.buffer[i]));
        }
        ctx.stroke();
        const gradient = ctx.createLinearGradient(cursor, 0, cursor - 10, 0);
        gradient.addColorStop(0, color); gradient.addColorStop(1, "transparent");
        ctx.fillStyle = gradient; ctx.globalAlpha = 0.3; ctx.fillRect(cursor - 10, 0, 10, height); 
        ctx.globalAlpha = 1.0; ctx.fillStyle = '#000'; ctx.fillRect(cursor, 0, eraserGap, height); 
    }
    requestRef.current = requestAnimationFrame(animate);
  };

  useEffect(() => {
    requestRef.current = requestAnimationFrame(animate);
    return () => cancelAnimationFrame(requestRef.current);
  }, [rhythmType, waveType, lead]);

  return (
    <div className="w-full h-full bg-black relative overflow-hidden group flex-1">
      <canvas ref={canvasRef} width={600} height={160} className="w-full h-full block" />
      <div className="absolute top-2 left-2 px-2 py-1 rounded bg-black/50 font-bold font-mono text-lg drop-shadow-md" style={{ color }}>{label}</div>
    </div>
  );
});

const VitalBox = memo(({ label, value, unit, color, subValue = null, blink = false, isNIBP = false, isAlarm = false }) => (
  <div className={`flex flex-col justify-between p-2 border-b border-l border-gray-800 h-1/4 bg-black transition-colors duration-300 ${blink || isAlarm ? 'bg-red-900/50' : ''}`}>
    <div className="flex justify-between items-start">
      <span className={`text-xs font-bold ${isAlarm ? 'text-red-500' : ''}`} style={{ color: isAlarm ? undefined : color }}>{label}</span>
      <Bell size={12} className={isAlarm ? "text-red-500 animate-bounce" : "text-gray-500"} />
    </div>
    <div className="flex items-baseline justify-end space-x-2">
       {subValue && <div className="flex flex-col items-end">{subValue}</div>}
       <span className={`font-mono font-bold tracking-tighter text-right ${isNIBP ? 'text-3xl' : 'text-5xl'} ${isAlarm ? 'text-red-500' : ''}`} style={{ color: isAlarm ? undefined : color }}>{value}</span>
       {!isNIBP && <span className="text-xs font-bold text-gray-400 mb-1">{unit}</span>}
    </div>
    {isNIBP && <div className="text-right text-xs text-gray-400 -mt-1">{unit}</div>}
  </div>
));

const SoftKey = ({ label, active, onClick, color = "text-gray-300", icon: Icon }) => (
  <button onClick={onClick} className={`flex-1 border-r border-gray-700 h-14 flex flex-col items-center justify-center text-xs font-bold transition-colors uppercase tracking-wide cursor-pointer ${active ? 'bg-gray-200 text-black' : 'bg-gray-900 hover:bg-gray-800'} ${active ? '' : color}`}>
    {Icon && <Icon size={14} className="mb-1"/>}
    {label}
  </button>
);

// --- MONITOR VIEW ---
const MonitorView = ({ sessionData, user }) => {
  const [nibpState, setNibpState] = useState({ status: 'IDLE', pressure: 0 });
  const liveHRRef = useRef(80);
  const [displayHR, setDisplayHR] = useState(80);

  useEffect(() => {
    if (!sessionData) return;
    
    if (sessionData.nibpCommand === 'START' && nibpState.status === 'IDLE') {
        setNibpState({ status: 'INFLATING', pressure: 0 });
        updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'sessions', 'default'), { nibpCommand: 'ACK' });
    }

    // Priority: Manual Target HR (from remote) -> Rhythm Preset
    let target = sessionData.rhythm === 'Sinus' ? 80 : sessionData.rhythm === 'Brady' ? 40 : sessionData.rhythm === 'Tachy' ? 150 : sessionData.rhythm === 'VFib' ? 300 : 0;
    
    // Check if manual override exists (and is not null)
    if (sessionData.targetHR !== undefined && sessionData.targetHR !== null) {
      target = sessionData.targetHR;
    }
    
    liveHRRef.current = target;
    
    const timer = setInterval(() => {
        if (sessionData.rhythm === 'VFib') setDisplayHR('---');
        else if (sessionData.rhythm === 'Asystole') setDisplayHR(0);
        else setDisplayHR(Math.round(target + (Math.random()*2-1)));
    }, 1000);
    return () => clearInterval(timer);
  }, [sessionData, nibpState.status]);

  useEffect(() => {
    let interval;
    if (nibpState.status === 'INFLATING') {
        interval = setInterval(() => setNibpState(p => {
             if(p.pressure >= 170) return { status: 'MEASURING', pressure: 170 };
             return { ...p, pressure: p.pressure + 8 };
        }), 100);
    } else if (nibpState.status === 'MEASURING') {
        interval = setInterval(() => setNibpState(p => {
            if(p.pressure <= 80) {
                const noise = Math.floor(Math.random()*10)-5;
                const newBP = { sys: 120+noise, dia: 80+noise, lastTime: new Date().toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'}) };
                updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'sessions', 'default'), { nibp: newBP, nibpCommand: 'IDLE' });
                return { status: 'IDLE', pressure: 0 };
            }
            return { ...p, pressure: p.pressure - 4 };
        }), 150);
    }
    return () => clearInterval(interval);
  }, [nibpState.status]);

  if (!sessionData) return <div className="flex items-center justify-center h-screen bg-black text-white">Connecting to Monitor...</div>;

  const getNibpDisplay = () => {
      if (nibpState.status !== 'IDLE') return <span className="text-yellow-400 animate-pulse">CUFF {nibpState.pressure}</span>;
      return <span>{sessionData.nibp?.sys || 120}<span className="text-2xl">/{sessionData.nibp?.dia || 80}</span></span>;
  };

  return (
    <div className="flex flex-col h-screen bg-black overflow-hidden">
        <div className="flex justify-between items-center px-4 py-2 bg-gray-900 text-white border-b border-gray-700 text-sm font-bold uppercase tracking-wider">
           <div className="flex items-center space-x-4">
              <span className="text-yellow-500">{sessionData.patient?.age || 'Adult'}</span>
              <span className="text-white">{sessionData.patient?.name || 'No Patient'}</span>
           </div>
           <div className="flex items-center space-x-4">
              <span className="text-green-500 flex gap-2 items-center"><Wifi size={16}/> ONLINE</span>
              <span className="text-green-500 flex gap-2 items-center"><Battery size={16}/> 98%</span>
           </div>
        </div>
        
        <div className="flex flex-1 relative">
            <div className="flex-1 flex flex-col border-r border-gray-800">
                <WaveformCanvas label="II" color="#00ff00" gridColor="#222" targetRate={liveHRRef} rhythmType={sessionData.rhythm} waveType="ecg" />
                <WaveformCanvas label="Pleth" color="#00ffff" gridColor="#222" targetRate={liveHRRef} rhythmType={sessionData.rhythm} waveType="pleth" />
                <WaveformCanvas label="CO2" color="#facc15" gridColor="#222" targetRate={liveHRRef} rhythmType={sessionData.rhythm} waveType="co2" />
            </div>
            <div className="w-1/4 flex flex-col bg-black border-l border-gray-800">
                <VitalBox label="HR" value={displayHR} unit="1/min" color="#00ff00" isAlarm={sessionData.rhythm === 'VFib' || sessionData.rhythm === 'Asystole'} />
                <VitalBox label="SpO2" value={sessionData.spo2 || 98} unit="%" color="#00ffff" />
                <VitalBox label="EtCO2" value={sessionData.etco2 || 38} unit="mmHg" color="#facc15" />
                <VitalBox label="NIBP" value={getNibpDisplay()} unit="mmHg" color="#ffffff" isNIBP={true} subValue={<span className="text-sm text-gray-500">{sessionData.nibp?.lastTime || '--:--'}</span>} />
            </div>
        </div>

        <div className="flex border-t border-gray-800 bg-gray-900 h-16 opacity-50 pointer-events-none">
           <SoftKey label="Monitor" active={true} />
           <SoftKey label="Patient" />
           <SoftKey label="Trend" />
           <SoftKey label="Alarms" />
           <SoftKey label="Menu" />
        </div>
    </div>
  );
};

// --- REMOTE VIEW ---
const RemoteView = ({ sessionData }) => {
  const [nameInput, setNameInput] = useState('');
  const [manualHR, setManualHR] = useState('');

  const updateSession = (fields) => {
      updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'sessions', 'default'), fields);
  };

  // When selecting a rhythm, we clear the manual heart rate override
  const setRhythm = (r) => {
      updateSession({ rhythm: r, targetHR: null }); // null clears the override
  };

  const applyManualHR = () => {
    const val = parseInt(manualHR);
    if (!isNaN(val) && val >= 0 && val <= 300) {
      updateSession({ targetHR: val });
    }
  };

  return (
    <div className="min-h-screen bg-gray-900 text-white p-4 pb-20 font-sans">
        <div className="mb-6 flex items-center justify-between">
            <h1 className="text-xl font-bold flex items-center gap-2"><Smartphone size={24} className="text-blue-400"/> Remote Control</h1>
            <div className="text-xs text-green-400 flex items-center gap-1"><Wifi size={12}/> Connected</div>
        </div>

        {/* RHYTHM SELECTOR */}
        <div className="bg-gray-800 rounded-xl p-4 mb-4 shadow-lg border border-gray-700">
            <h2 className="text-xs font-bold text-gray-400 uppercase mb-3 tracking-wider">ECG Rhythm</h2>
            <div className="grid grid-cols-3 gap-2">
                {['Sinus', 'Brady', 'Tachy', 'VFib', 'Asystole'].map(r => (
                    <button 
                        key={r}
                        onClick={() => setRhythm(r)}
                        className={`py-4 rounded-lg font-bold text-sm transition-all ${sessionData?.rhythm === r ? 'bg-blue-600 text-white ring-2 ring-white scale-105' : 'bg-gray-700 text-gray-300'}`}
                    >
                        {r}
                    </button>
                ))}
            </div>
        </div>

        {/* VITALS ADJUSTMENT */}
        <div className="bg-gray-800 rounded-xl p-4 mb-4 shadow-lg border border-gray-700">
            <h2 className="text-xs font-bold text-gray-400 uppercase mb-3 tracking-wider">Vitals Override</h2>
            <div className="space-y-5">
                {/* HR Manual Input */}
                <div>
                    <div className="flex justify-between mb-2">
                        <span className="text-sm font-bold text-gray-300 flex items-center gap-2"><Heart size={14} className="text-green-500"/> Heart Rate (HR)</span> 
                        <span className="font-mono font-bold text-green-400">
                           {sessionData?.targetHR ? sessionData.targetHR : '(Auto)'}
                        </span>
                    </div>
                    <div className="flex gap-2">
                        <input 
                            type="number" 
                            placeholder="Manual HR..." 
                            className="flex-1 bg-black border border-gray-600 rounded p-2 text-white font-mono"
                            value={manualHR}
                            onChange={(e) => setManualHR(e.target.value)}
                        />
                        <button onClick={applyManualHR} className="bg-green-700 text-white px-4 rounded font-bold text-sm">SET</button>
                        {sessionData?.targetHR && (
                           <button onClick={() => updateSession({targetHR: null})} className="bg-gray-700 text-white px-3 rounded font-bold text-xs">AUTO</button>
                        )}
                    </div>
                </div>

                <div>
                    <div className="flex justify-between mb-1"><span className="text-sm font-bold text-gray-300">SpO2</span> <span className="font-mono font-bold text-cyan-400">{sessionData?.spo2}%</span></div>
                    <input type="range" min="50" max="100" value={sessionData?.spo2 || 98} onChange={(e) => updateSession({ spo2: parseInt(e.target.value) })} className="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-cyan-500"/>
                </div>
                <div>
                    <div className="flex justify-between mb-1"><span className="text-sm font-bold text-gray-300">EtCO2</span> <span className="font-mono font-bold text-yellow-400">{sessionData?.etco2}</span></div>
                    <input type="range" min="0" max="60" value={sessionData?.etco2 || 38} onChange={(e) => updateSession({ etco2: parseInt(e.target.value) })} className="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-yellow-500"/>
                </div>
            </div>
        </div>

        {/* ACTIONS */}
        <div className="grid grid-cols-2 gap-4 mb-4">
            <button 
                onClick={() => updateSession({ nibpCommand: 'START' })}
                className="bg-gray-800 p-4 rounded-xl flex flex-col items-center justify-center active:bg-gray-700 active:scale-95 transition-all border border-gray-700"
            >
                <Activity className="mb-2 text-blue-400" />
                <span className="font-bold text-sm">Start NIBP</span>
            </button>
             <button 
                onClick={() => updateSession({ nibp: { sys: '---', dia: '---', lastTime: '--:--' }})} 
                className="bg-gray-800 p-4 rounded-xl flex flex-col items-center justify-center active:bg-gray-700 active:scale-95 transition-all border border-gray-700"
            >
                <Bell className="mb-2 text-red-400" />
                <span className="font-bold text-sm">Reset NIBP</span>
            </button>
        </div>

        {/* PATIENT DATA */}
        <div className="bg-gray-800 rounded-xl p-4 shadow-lg border border-gray-700">
             <h2 className="text-xs font-bold text-gray-400 uppercase mb-3 tracking-wider">Patient Identity</h2>
             <div className="flex gap-2">
                <input 
                    type="text" 
                    placeholder="Enter Name..." 
                    className="flex-1 bg-black border border-gray-600 rounded p-3 text-white"
                    value={nameInput}
                    onChange={(e) => setNameInput(e.target.value)}
                />
                <button 
                    onClick={() => { updateSession({ patient: { ...sessionData?.patient, name: nameInput } }); setNameInput(''); }}
                    className="bg-blue-600 px-4 rounded font-bold text-sm"
                >
                    SET
                </button>
             </div>
             <div className="mt-2 text-xs text-gray-500">Current: {sessionData?.patient?.name || 'None'}</div>
        </div>
    </div>
  );
};

// --- MAIN APP CONTROLLER ---
export default function CorpulsDistributed() {
  const [view, setView] = useState('landing'); // landing, monitor, remote
  const [user, setUser] = useState(null);
  const [sessionData, setSessionData] = useState(null);

  useNoIndex(); // Inject SEO protection

  // 1. Auth & Init
  useEffect(() => {
    const initAuth = async () => {
        if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
            await signInWithCustomToken(auth, __initial_auth_token);
        } else {
            await signInAnonymously(auth);
        }
    };
    initAuth();
    return onAuthStateChanged(auth, setUser);
  }, []);

  // 2. Data Sync
  useEffect(() => {
    if (!user) return;
    // Use the provided appId variable (works for both preview & standalone)
    const sessionRef = doc(db, 'artifacts', appId, 'public', 'data', 'sessions', 'default');
    
    // Ensure doc exists
    setDoc(sessionRef, { rhythm: 'Sinus', spo2: 98, etco2: 38, nibp: { sys: 120, dia: 80, lastTime: '--:--' }, patient: { name: '', age: '' } }, { merge: true });

    const unsub = onSnapshot(sessionRef, (snap) => {
        if (snap.exists()) setSessionData(snap.data());
    });
    return () => unsub();
  }, [user]);

  if (!user) return <div className="h-screen bg-black text-white flex items-center justify-center font-mono">Authenticating...</div>;

  if (view === 'landing') {
      return (
          <div className="h-screen bg-gray-900 text-white flex flex-col items-center justify-center p-4 font-sans">
              <div className="text-center mb-10">
                  <h1 className="text-4xl font-bold mb-2 text-blue-400 tracking-tight">C3 SIMULATOR</h1>
                  <p className="text-gray-400">Distributed Training Environment</p>
              </div>
              
              <div className="grid md:grid-cols-2 gap-6 w-full max-w-2xl">
                  <button 
                    onClick={() => setView('monitor')}
                    className="group relative bg-gray-800 border border-gray-700 hover:border-blue-500 p-8 rounded-2xl flex flex-col items-center transition-all hover:scale-105 hover:shadow-2xl hover:shadow-blue-900/20"
                  >
                      <Monitor size={64} className="mb-4 text-gray-300 group-hover:text-blue-400 transition-colors" />
                      <h2 className="text-2xl font-bold mb-2">Launch Monitor</h2>
                      <p className="text-sm text-gray-500 text-center">Open this on the main display screen.</p>
                  </button>

                  <button 
                    onClick={() => setView('remote')}
                    className="group relative bg-gray-800 border border-gray-700 hover:border-green-500 p-8 rounded-2xl flex flex-col items-center transition-all hover:scale-105 hover:shadow-2xl hover:shadow-green-900/20"
                  >
                      <Smartphone size={64} className="mb-4 text-gray-300 group-hover:text-green-400 transition-colors" />
                      <h2 className="text-2xl font-bold mb-2">Launch Remote</h2>
                      <p className="text-sm text-gray-500 text-center">Open this on a tablet or mobile device.</p>
                  </button>
              </div>
          </div>
      );
  }

  if (view === 'monitor') return <MonitorView sessionData={sessionData} user={user} />;
  if (view === 'remote') return <RemoteView sessionData={sessionData} />;
}
