<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Bali-Cup 2025 - Eingabe Panel</title>
  <style>
    /* Stildefinitionen hier */
  </style>
</head>
<body>
  <div id="loginModal" class="modal" style="display: block;">
    <div class="modal-content">
      <h2>Bitte Admin-Passwort eingeben</h2>
      <input type="password" id="loginPassword" placeholder="Passwort">
      <br>
      <button onclick="checkPassword()">Einloggen</button>
    </div>
  </div>

  <button class="toggle-mode" onclick="toggleMode()">Light/Dark Mode</button>

  <header>
    <h1>Bali-Cup 2025</h1>
    <img src="logo.png" alt="Wettbewerbslogo">
  </header>

  <div class="container">
    <button class="delete-cache-btn" onclick="clearDatabase()">Datenbank leeren</button>

    <section>
      <h2>Teams erstellen</h2>
      <form id="createTeamForm">
        <label for="newTeamName">Team Name:</label>
        <input type="text" id="newTeamName" required>
        <br>
        <button type="submit">Team anlegen</button>
      </form>
    </section>

    <section>
      <h2>Team Übersicht</h2>
      <table id="teamTable">
        <thead>
          <tr>
            <th>Team Name</th>
            <th>Station 1</th>
            <th>Station 2</th>
            <th>Station 3</th>
            <th>Station 4</th>
            <th>Station 5</th>
            <th>Station 6</th>
            <th>Station 7</th>
            <th>Station 8</th>
            <th>Gesamtpunkte</th>
            <th>Aktionen</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </section>

    <button onclick="openModal()">Ranking anzeigen</button>
  </div>

  <div id="rankingModal" class="modal">
    <div class="modal-content">
      <button class="close-modal" onclick="closeModal()">✖</button>
      <h2>Top Ranking</h2>
      <table>
        <thead>
          <tr>
            <th>Platz</th>
            <th>Team</th>
            <th>Punkte</th>
            <th>Abgeschlossene Stationen</th>
          </tr>
        </thead>
        <tbody id="rankingBody"></tbody>
      </table>
    </div>
  </div>

  <footer>
    <p id="versionDisplay">Version: 1.1.0</p>
  </footer>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.5.0/firebase-app.js";
    import { getFirestore, collection, addDoc, onSnapshot, updateDoc, deleteDoc, doc, getDocs } 
      from "https://www.gstatic.com/firebasejs/11.5.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "API-KEY",
      authDomain: "DOMAIN",
      projectId: "PROJECT-ID",
      storageBucket: "STORAGE",
      messagingSenderId: "SENDER-ID",
      appId: "APP-ID"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    async function calculateRanking() {
      const teamsSnapshot = await getDocs(collection(db, "teams"));
      let teams = [];
      teamsSnapshot.forEach(doc => {
        const data = doc.data();
        const totalPoints = Object.values(data.scores || {}).reduce((sum, val) => sum + val, 0);
        const completedStations = Object.values(data.scores || {}).filter(val => val > 0).length;
        teams.push({ id: doc.id, name: data.name, totalPoints, completedStations });
      });
      teams.sort((a, b) => b.totalPoints - a.totalPoints || b.completedStations - a.completedStations);
      updateRankingTable(teams);
    }

    function updateRankingTable(teams) {
      const rankingBody = document.getElementById("rankingBody");
      rankingBody.innerHTML = "";
      teams.forEach((team, index) => {
        const row = `<tr><td>${index + 1}</td><td>${team.name}</td><td>${team.totalPoints}</td><td>${team.completedStations}</td></tr>`;
        rankingBody.innerHTML += row;
      });
    }

    function openModal() {
      document.getElementById("rankingModal").style.display = "block";
      calculateRanking();
    }

    function closeModal() {
      document.getElementById("rankingModal").style.display = "none";
    }
  </script>
</body>
</html>
