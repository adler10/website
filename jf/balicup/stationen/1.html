<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ergebnisse für Station <span id="stationLabel"></span> – Bali-Cup 2025</title>
  <style>
    :root {
      /* Standard Farben für Dark Mode */
      --btn-bg-dark: #555;
      --btn-border-dark: #666;
      --btn-hover-dark: #444;
      /* Farben für Light Mode */
      --btn-bg-light: #e7e7e7;
      --btn-border-light: #ccc;
      --btn-hover-light: #d7d7d7;
    }
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      background: #222; /* Dark Mode */
      color: #fff;
      transition: background 0.3s, color 0.3s;
    }
    /* Light Mode Styles */
    body.light-mode {
      background: #f5f5f5;
      color: #333;
    }
    header {
      text-align: center;
      margin-bottom: 20px;
    }
    .container {
      max-width: 400px;
      margin: 0 auto;
      padding: 20px;
      background: #333;
      border: 1px solid #444;
      border-radius: 4px;
    }
    body.light-mode .container {
      background: #fff;
      border: 1px solid #ccc;
    }
    label {
      display: block;
      margin-top: 10px;
    }
    select, input, button {
      font-size: 1em;
      padding: 10px;
      margin-top: 5px;
      width: 100%;
      box-sizing: border-box;
    }
    button {
      cursor: pointer;
      background: var(--btn-bg-dark);
      border: 1px solid var(--btn-border-dark);
      color: #fff;
      transition: background 0.3s;
    }
    button:hover {
      background: var(--btn-hover-dark);
    }
    body.light-mode button {
      background: var(--btn-bg-light);
      border: 1px solid var(--btn-border-light);
      color: #333;
    }
    body.light-mode button:hover {
      background: var(--btn-hover-light);
    }
    #feedback {
      margin-top: 15px;
      padding: 10px;
      border-radius: 4px;
      text-align: center;
      display: none;
    }
    #feedback.success {
      background-color: #4caf50;
      color: #fff;
    }
    #feedback.error {
      background-color: #f44336;
      color: #fff;
    }
    .toggle-mode {
      position: fixed;
      top: 10px;
      right: 10px;
      padding: 4px 6px;
      font-size: 0.9em;
      cursor: pointer;
      border: 1px solid var(--btn-border-dark);
      background: var(--btn-bg-dark);
      transition: background 0.3s;
      white-space: nowrap;
    }
    .toggle-mode:hover {
      background: var(--btn-hover-dark);
    }
    body.light-mode .toggle-mode {
      border: 1px solid var(--btn-border-light);
      background: var(--btn-bg-light);
    }
    body.light-mode .toggle-mode:hover {
      background: var(--btn-hover-light);
    }
    .teams-info {
      margin-top: 20px;
    }
    .teams-info h2 {
      text-align: center;
      margin-bottom: 10px;
    }
    .group-container {
      margin-bottom: 20px;
    }
    .team-card {
      padding: 10px;
      margin: 10px;
      border-radius: 4px;
      border: 1px solid;
      text-align: center;
    }
    body:not(.light-mode) .team-card.participated {
      background: #388e3c;
      border-color: #2e7d32;
      color: #fff;
    }
    body:not(.light-mode) .team-card.not-participated {
      background: #d32f2f;
      border-color: #c62828;
      color: #fff;
    }
    body.light-mode .team-card.participated {
      background: #81c784;
      border-color: #66bb6a;
      color: #333;
    }
    body.light-mode .team-card.not-participated {
      background: #e57373;
      border-color: #ef5350;
      color: #333;
    }
    /* Mobile Responsive */
    @media (max-width: 600px) {
      body { margin: 10px; }
      .container { padding: 15px; margin: 0 5px; }
      header h1 { font-size: 1.3em; }
      label, select, input, button { font-size: 1em; }
      .toggle-mode {
        top: 5px; right: 5px;
        padding: 3px 5px; font-size: 0.8em;
      }
      .teams-info h2 { font-size: 1.1em; }
      .team-card { margin: 8px 5px; font-size: 0.9em; padding: 8px; }
    }
  </style>
</head>
<body>
  <button class="toggle-mode" onclick="toggleMode()">Light Mode</button>

  <header>
    <h1>Ergebnisse für Station <span id="stationId"></span> – <span id="stationLabel"></span> erfassen</h1>
  </header>
  <div class="container">
    <form id="resultForm">
      <label for="teamSelect">Team auswählen:</label>
      <select id="teamSelect" required>
        <option value="" disabled selected>Bitte wähle ein Team</option>
      </select>

      <label for="points">Punkte:</label>
      <input type="number" id="points" placeholder="Punkte" min="0" required>

      <button type="submit">Ergebnis speichern</button>
    </form>
    <div id="feedback"></div>
    <div class="teams-info" id="teamsInfo"></div>
  </div>

  <script type="module">
    const stationName = "Schätzspiel";
    const stationNumber = 1;
    const allowedGroups = {
      dropdown: ["normale gruppe", "kindergruppe"],
      teams:     ["normale gruppe", "kindergruppe"]
    };

    document.getElementById("stationLabel").textContent = stationName;
    document.getElementById("stationId").textContent = stationNumber;

    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.5.0/firebase-app.js";
    import {
      getFirestore, collection, query, where, getDocs,
      updateDoc, doc, addDoc, setDoc, onSnapshot
    } from "https://www.gstatic.com/firebasejs/11.5.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "…",
      authDomain: "bali-cup2025.firebaseapp.com",
      projectId: "bali-cup2025",
      storageBucket: "bali-cup2025.firebasestorage.app",
      messagingSenderId: "867421335336",
      appId: "1:867421335336:web:e046ccb32b631dcbf86a1d",
      measurementId: "G-484CZNKVQ1"
    };
    const app = initializeApp(firebaseConfig);
    const db  = getFirestore(app);

    // Nur bestätigte Teams laden (Status != \"vorgemerkt\")
    async function loadTeamsDropdown() {
      const teamsRef = collection(db, "teams");
      const snaps    = await getDocs(teamsRef);
      const sel      = document.getElementById("teamSelect");
      sel.innerHTML  = '<option value=\"\" disabled selected>Bitte wähle ein Team</option>';

      const normal = [], kinder = [];
      snaps.forEach(docSnap => {
        const data = docSnap.data();
        // Skip, wenn vorgemerkt
        if ((data.confirmed || "").toLowerCase() === "true") return;
        // Skip, wenn schon Punkte erfasst
        if (data["station" + stationNumber] > 0) return;

        const type = (data.teamType || "normale gruppe").toLowerCase();
        if (!allowedGroups.dropdown.includes(type)) return;

        const teamObj = { id: docSnap.id, name: data.teamName };
        if (type === "kindergruppe") kinder.push(teamObj);
        else normal.push(teamObj);
      });
      // Alphabetisch und Optgroups
      normal.sort((a,b)=>a.name.localeCompare(b.name));
      kinder.sort((a,b)=>a.name.localeCompare(b.name));

      if (normal.length) {
        const og = document.createElement("optgroup");
        og.label = "Normale Gruppe";
        normal.forEach(t=>{ 
          const o = document.createElement("option");
          o.value = t.id; o.textContent = t.name;
          og.appendChild(o);
        });
        sel.appendChild(og);
      }
      if (kinder.length) {
        const og = document.createElement("optgroup");
        og.label = "Kindergruppe";
        kinder.forEach(t=>{
          const o = document.createElement("option");
          o.value = t.id; o.textContent = t.name;
          og.appendChild(o);
        });
        sel.appendChild(og);
      }
    }
    loadTeamsDropdown();

    // … Restliche Funktionen bleiben unverändert …
    // toggleMode(), loadTeamsInfo(), showFeedback(), resultForm-submit, station-Listener etc.
    window.toggleMode = () => {
      document.body.classList.toggle("light-mode");
      const btn = document.querySelector(".toggle-mode");
      btn.textContent = document.body.classList.contains("light-mode") ? "Dark Mode" : "Light Mode";
    };
  </script>
</body>
</html>
