<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Bali-Cup 2025 - Eingabe Panel</title>
  <style>
    /* Basis-Variablen für Light Mode */
    :root {
      --bg-color: #f5f5f5;
      --text-color: #333;
      --header-bg: #fff;
      --container-bg: #fff;
      --button-bg: #e7e7e7;
      --button-border: #ccc;
      --button-hover: #d7d7d7;
      --delete-bg: #f44336;
      --delete-hover: #d32f2f;
    }
    /* Dark Mode */
    body.dark {
      --bg-color: #1e1e1e;
      --text-color: #eee;
      --header-bg: #2c2c2c;
      --container-bg: #2c2c2c;
      --button-bg: #444;
      --button-border: #666;
      --button-hover: #555;
      --delete-bg: #d32f2f;
      --delete-hover: #b71c1c;
    }
    
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      background-color: var(--bg-color);
      color: var(--text-color);
      transition: background-color 0.3s, color 0.3s;
    }
    header {
      text-align: center;
      padding: 20px;
      background-color: var(--header-bg);
      border: 1px solid var(--button-border);
      margin-bottom: 20px;
    }
    header img {
      max-height: 100px;
      display: block;
      margin: 0 auto 10px;
    }
    .container {
      background-color: var(--container-bg);
      padding: 20px;
      border: 1px solid var(--button-border);
      margin-bottom: 20px;
    }
    form { margin-bottom: 20px; }
    label { display: inline-block; width: 150px; }
    input[type="text"],
    input[type="number"],
    select { padding: 5px; margin: 5px 0; }
    button {
      padding: 7px 15px;
      margin-top: 10px;
      cursor: pointer;
      border: 1px solid var(--button-border);
      background-color: var(--button-bg);
      color: var(--text-color);
    }
    button:hover { background-color: var(--button-hover); }
    .delete-cache-btn {
      background-color: var(--delete-bg);
      color: white;
      border: none;
      padding: 10px 15px;
      border-radius: 4px;
    }
    .delete-cache-btn:hover { background-color: var(--delete-hover); }
    table {
      border-collapse: collapse;
      width: 100%;
      margin-top: 20px;
    }
    table, th, td {
      border: 1px solid var(--button-border);
    }
    th, td {
      padding: 8px;
      text-align: center;
    }
    th { background-color: var(--button-bg); }
    .action-btn {
      margin: 0 3px;
      padding: 5px 10px;
      border: 1px solid var(--button-border);
      background-color: var(--button-bg);
      cursor: pointer;
    }
    .action-btn:hover { background-color: var(--button-hover); }
    
    /* Modal für Ranking */
    .modal {
      display: none; /* per default versteckt */
      position: fixed;
      z-index: 100;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background-color: rgba(0,0,0,0.5);
    }
    .modal-content {
      background-color: var(--container-bg);
      margin: 15% auto;
      padding: 20px;
      border: 1px solid var(--button-border);
      width: 80%;
      max-width: 500px;
      border-radius: 4px;
      position: relative;
    }
    .close-modal {
      position: absolute;
      top: 10px;
      right: 10px;
      cursor: pointer;
      font-size: 1.2em;
      border: none;
      background: none;
      color: var(--text-color);
    }
    /* Toggle Button für Dark/Light Mode */
    .toggle-mode {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 8px 12px;
      cursor: pointer;
      border: 1px solid var(--button-border);
      background-color: var(--button-bg);
      color: var(--text-color);
    }
  </style>
</head>
<body>

  <!-- Dark/Light Mode Toggle -->
  <button class="toggle-mode" onclick="toggleMode()">Light/Dark Mode</button>

  <!-- Header-Bereich mit festem Wettbewerbstitel und Logo -->
  <header>
    <h1>Bali-Cup 2025</h1>
    <!-- Logo (vorausgesetzt, logo.png liegt im gleichen Verzeichnis) -->
    <img src="logo.png" alt="Wettbewerbslogo">
  </header>

  <div class="container">
    <!-- Button zum Löschen des LocalStorage -->
    <button class="delete-cache-btn" onclick="clearCache()" title="Lokalen Cache löschen">
      Cache leeren
    </button>

    <!-- Abschnitt: Teams erstellen -->
    <section>
      <h2>Teams erstellen</h2>
      <form id="createTeamForm">
        <label for="newTeamName">Team Name:</label>
        <input type="text" id="newTeamName" required>
        <br>
        <button type="submit" title="Team anlegen">Team anlegen</button>
      </form>
    </section>

    <!-- Tabelle zur Anzeige aller Teams -->
    <section>
      <h2>Team Übersicht</h2>
      <table id="teamTable">
        <thead>
          <tr>
            <th>Team Name</th>
            <th>Station 1</th>
            <th>Station 2</th>
            <th>Station 3</th>
            <th>Station 4</th>
            <th>Station 5</th>
            <th>Station 6</th>
            <th>Station 7</th>
            <th>Station 8</th>
            <th>Gesamtpunkte</th>
            <th>Aktionen</th>
          </tr>
        </thead>
        <tbody>
        </tbody>
      </table>
    </section>

    <!-- Button zum Öffnen des Ranking-Popups -->
    <button onclick="openModal()" title="Ranking anzeigen">Ranking anzeigen</button>
  </div>

  <!-- Modal für Ranking -->
  <div id="rankingModal" class="modal">
    <div class="modal-content">
      <button class="close-modal" onclick="closeModal()">✖</button>
      <h2>Top Ranking</h2>
      <ol id="rankingList">
      </ol>
    </div>
  </div>

  <script>
    // Dark/Light Mode Toggle
    function toggleMode() {
      document.body.classList.toggle('dark');
    }

    // Teams und Punkte
    let teams = [];
    let teamIdCounter = 0; // Eindeutige ID für jedes Team

    // Speichert die Daten in LocalStorage
    function storeData() {
      localStorage.setItem('teamsData', JSON.stringify(teams));
    }

    // Lädt die Daten aus LocalStorage
    function loadData() {
      const storedTeams = localStorage.getItem('teamsData');
      if (storedTeams) {
        teams = JSON.parse(storedTeams);
        teamIdCounter = teams.reduce((max, team) => Math.max(max, team.id), 0) + 1;
      }
    }

    // Berechnet die Gesamtsumme der Punkte eines Teams
    function calculateTotal(team) {
      return team.station1 + team.station2 + team.station3 + team.station4 +
             team.station5 + team.station6 + team.station7 + team.station8;
    }

    // Aktualisiert die gesamte Tabelle
    function updateTeamTable() {
      const tbody = document.getElementById('teamTable').getElementsByTagName('tbody')[0];
      tbody.innerHTML = '';
      teams.forEach(team => {
        const tr = document.createElement('tr');
        tr.setAttribute('data-team-id', team.id);
        tr.innerHTML = `
          <td>${team.teamName}</td>
          <td>${team.station1}</td>
          <td>${team.station2}</td>
          <td>${team.station3}</td>
          <td>${team.station4}</td>
          <td>${team.station5}</td>
          <td>${team.station6}</td>
          <td>${team.station7}</td>
          <td>${team.station8}</td>
          <td>${team.total}</td>
          <td>
            <button class="action-btn" onclick="editTeam(${team.id})" title="Bearbeiten">Bearbeiten</button>
            <button class="action-btn" onclick="deleteTeam(${team.id})" title="Löschen">Löschen</button>
          </td>
        `;
        tbody.appendChild(tr);
      });
      updateRanking();
    }

    // Aktualisiert das Ranking basierend auf den Gesamtpunkten
    function updateRanking() {
      const sortedTeams = teams.slice().sort((a, b) => b.total - a.total);
      const rankingList = document.getElementById('rankingList');
      rankingList.innerHTML = '';
      sortedTeams.forEach(team => {
        const li = document.createElement('li');
        li.textContent = `${team.teamName} - ${team.total} Punkte`;
        rankingList.appendChild(li);
      });
    }

    // Neues Team anlegen
    document.getElementById('createTeamForm').addEventListener('submit', function(e) {
      e.preventDefault();
      const teamName = document.getElementById('newTeamName').value.trim();
      if (!teamName) return;
      const team = {
        id: teamIdCounter++,
        teamName: teamName,
        station1: 0,
        station2: 0,
        station3: 0,
        station4: 0,
        station5: 0,
        station6: 0,
        station7: 0,
        station8: 0,
        total: 0
      };
      teams.push(team);
      storeData();
      updateTeamTable();
      this.reset();
    });

    // Löscht ein Team nach Bestätigung
    function deleteTeam(teamId) {
      if (confirm("Soll dieses Team wirklich gelöscht werden?")) {
        teams = teams.filter(t => t.id !== teamId);
        storeData();
        updateTeamTable();
      }
    }

    // Löscht den gesamten LocalStorage und lädt die Seite neu
    function clearCache() {
      if (confirm("Sollen wirklich alle gespeicherten Daten gelöscht werden?")) {
        localStorage.removeItem('teamsData');
        teams = [];
        updateTeamTable();
      }
    }

    // Versetzt eine Zeile in den Editiermodus
    function editTeam(teamId) {
      const team = teams.find(t => t.id === teamId);
      const tr = document.querySelector(`tr[data-team-id='${teamId}']`);
      tr.innerHTML = `
        <td>${team.teamName}</td>
        <td><input type="number" min="0" value="${team.station1}" style="width: 60px;" id="edit-st1-${teamId}"></td>
        <td><input type="number" min="0" value="${team.station2}" style="width: 60px;" id="edit-st2-${teamId}"></td>
        <td><input type="number" min="0" value="${team.station3}" style="width: 60px;" id="edit-st3-${teamId}"></td>
        <td><input type="number" min="0" value="${team.station4}" style="width: 60px;" id="edit-st4-${teamId}"></td>
        <td><input type="number" min="0" value="${team.station5}" style="width: 60px;" id="edit-st5-${teamId}"></td>
        <td><input type="number" min="0" value="${team.station6}" style="width: 60px;" id="edit-st6-${teamId}"></td>
        <td><input type="number" min="0" value="${team.station7}" style="width: 60px;" id="edit-st7-${teamId}"></td>
        <td><input type="number" min="0" value="${team.station8}" style="width: 60px;" id="edit-st8-${teamId}"></td>
        <td id="total-${teamId}">${team.total}</td>
        <td>
          <button class="action-btn" onclick="saveTeam(${teamId})" title="Speichern">Speichern</button>
          <button class="action-btn" onclick="cancelEdit(${teamId})" title="Abbrechen">Abbrechen</button>
        </td>
      `;
      for (let i = 1; i <= 8; i++) {
        document.getElementById(`edit-st${i}-${teamId}`).addEventListener('input', () => {
          updateRowTotal(teamId);
        });
      }
    }

    // Aktualisiert den Totalwert in der bearbeiteten Zeile
    function updateRowTotal(teamId) {
      let total = 0;
      for (let i = 1; i <= 8; i++) {
        const val = parseInt(document.getElementById(`edit-st${i}-${teamId}`).value, 10) || 0;
        total += val;
      }
      document.getElementById(`total-${teamId}`).textContent = total;
    }

    // Speichert die Änderungen und verlässt den Editiermodus
    function saveTeam(teamId) {
      const team = teams.find(t => t.id === teamId);
      for (let i = 1; i <= 8; i++) {
        team['station' + i] = parseInt(document.getElementById(`edit-st${i}-${teamId}`).value, 10) || 0;
      }
      team.total = calculateTotal(team);
      storeData();
      updateTeamTable();
    }

    // Bricht den Editiermodus ab und stellt den ursprünglichen Zustand wieder her
    function cancelEdit(teamId) {
      updateTeamTable();
    }

    // Modal öffnen und Ranking anzeigen
    function openModal() {
      document.getElementById('rankingModal').style.display = 'block';
    }
    // Modal schließen
    function closeModal() {
      document.getElementById('rankingModal').style.display = 'none';
    }

    // Beim Laden der Seite Daten aus LocalStorage laden
    window.addEventListener('load', () => {
      loadData();
      updateTeamTable();
    });
  </script>

</body>
</html>
